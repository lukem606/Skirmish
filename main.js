(()=>{"use strict";var t={426:(t,e,n)=>{n.d(e,{Z:()=>y});var i=n(81),a=n.n(i),o=n(645),r=n.n(o),s=n(667),l=n.n(s),u=new URL(n(872),n.b),c=new URL(n(562),n.b),h=r()(a()),f=l()(u),v=l()(c);h.push([t.id,'@font-face {\n  font-family: "PressStart2P";\n  font-style: normal;\n  font-weight: 400;\n  src: url('+f+')\n    format("woff2");\n  src: url('+v+') format("woff");\n}\n\nbody {\n  background-color: rgb(0, 0, 0);\n  margin: 0;\n}\n',""]);const y=h},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,a,o){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(r[l]=!0)}for(var u=0;u<t.length;u++){var c=[].concat(t[u]);i&&r[c[0]]||(void 0!==o&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),e.push(c))}},e}},667:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var o={},r=[],s=0;s<t.length;s++){var l=t[s],u=i.base?l[0]+i.base:l[0],c=o[u]||0,h="".concat(u," ").concat(c);o[u]=c+1;var f=n(h),v={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)e[f].references++,e[f].updater(v);else{var y=a(v,i);i.byIndex=s,e.splice(s,0,{identifier:h,updater:y,references:1})}r.push(h)}return r}function a(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,a){var o=i(t=t||[],a=a||{});return function(t){t=t||[];for(var r=0;r<o.length;r++){var s=n(o[r]);e[s].references--}for(var l=i(t,a),u=0;u<o.length;u++){var c=n(o[u]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}o=l}}},569:t=>{var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,a&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},562:(t,e,n)=>{t.exports=n.p+"fonts/76327b932046542e0e55.woff"},872:(t,e,n)=>{t.exports=n.p+"fonts/00bf2b9f869220e3f852.woff2"}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var o=e[i]={id:i,exports:{}};return t[i](o,o.exports,n),o.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.p="/Skirmish/",n.b=document.baseURI||self.location.href,(()=>{const t={WHITE:[255,255,255],GREY:[100,100,100],BLACK:[0,0,0],teams:{RED:[235,60,39],BLUE:[35,98,162],GREEN:[3,160,98],YELLOW:[251,183,65]}};function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,i;return n=t,i=[{key:"getRGB",value:function(t){return"rgb(".concat(t[0],", ").concat(t[1],", ").concat(t[2],")")}},{key:"getRGBA",value:function(t,e){return"rgba(".concat(t[0],", ").concat(t[1],", ").concat(t[2],", ").concat(e,")")}}],null&&e(n.prototype,null),i&&e(n,i),t}();function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.width=n.g.WIDTH,this.height=n.g.HEIGHT}var e,i;return e=t,(i=[{key:"render",value:function(t){for(var e=n.g.context,i=0;i<t.cellsY;i++)for(var a=0;a<t.cellsX;a++)e.strokeStyle="rgb(100, 100, 100, 0.3)",e.strokeRect(a*t.cellSize.x,i*t.cellSize.y,t.cellSize.x,t.cellSize.y)}}])&&a(e.prototype,i),t}();function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s,l=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"degreesToRadians",value:function(t){return t*Math.PI/180}},{key:"random",value:function(t,e){var n=e-t;return Math.random()*n+t}},{key:"gaussian",value:function(){for(var t=0,e=0;0===t;)t=Math.random();for(;0===e;)e=Math.random();return Math.sqrt(-1*Math.log(t))*Math.cos(1*Math.PI*e)}},{key:"mean",value:function(t){return t.reduce((function(t,e){return t+e}))/t.length}},{key:"map",value:function(t,e,n,i,a){return t/(e-n)*(i-a)}}],null&&r(e.prototype,null),n&&r(e,n),t}(),u=new Uint8Array(16);function c(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(u)}const h=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,f=function(t){return"string"==typeof t&&h.test(t)};for(var v=[],y=0;y<256;++y)v.push((y+256).toString(16).substr(1));const d=function(t,e,n){var i=(t=t||{}).random||(t.rng||c)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){n=n||0;for(var a=0;a<16;++a)e[n+a]=i[a];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(v[t[e+0]]+v[t[e+1]]+v[t[e+2]]+v[t[e+3]]+"-"+v[t[e+4]]+v[t[e+5]]+"-"+v[t[e+6]]+v[t[e+7]]+"-"+v[t[e+8]]+v[t[e+9]]+"-"+v[t[e+10]]+v[t[e+11]]+v[t[e+12]]+v[t[e+13]]+v[t[e+14]]+v[t[e+15]]).toLowerCase();if(!f(n))throw TypeError("Stringified UUID is invalid");return n}(i)};function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var g=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"getFormation",value:function(t){return 2===t?[[0,-1],[0,1]]:3===t?[[1,0],[-1,-1],[-1,1]]:4===t?[[1,-1],[1,1],[-1,-1],[-1,1]]:5===t?[[2,0],[0,-1],[0,1],[-2,-1],[-2,1]]:6===t?[[2,-1],[2,1],[0,-1],[0,1],[-2,-1],[-2,1]]:7===t?[[3,0],[1,-1],[1,1],[-1,-1],[-1,1],[-3,-1],[-3,1]]:8===t?[[3,-1],[3,1],[1,-1],[1,1],[-1,-1],[-1,1],[-3,-1],[-3,1]]:9===t?[[4,0],[2,-1],[2,1],[0,-1],[0,1],[-2,-1],[-2,1],[-4,-1],[-4,1]]:void 0}}],null&&p(e.prototype,null),n&&p(e,n),t}();function m(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var k=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;x(this,t),this.head=e,this.tail=e,this.length=e?1:0}var e,n;return e=t,n=[{key:"getAll",value:function(){for(var t=[],e=this.head;e;)t.push(e.value),e=e.next;return t}},{key:"printList",value:function(){for(var t=[],e=this.head;null!==e;)t.push(e),e=e.next;console.log([].concat(t))}},{key:"prepend",value:function(t){var e=new T(t);0===this.length?(this.head=e,this.tail=this.head):(e.next=this.head,this.head.previous=e,this.head=e),this.length++}},{key:"append",value:function(t){var e=new T(t);0===this.length?(this.head=e,this.tail=this.head):(this.tail.next=e,e.previous=this.tail,this.tail=e),this.length++}},{key:"insert",value:function(t,e){if(e<0||e>this.length||!Number.isInteger(e))console.warn("Index is not a valid integer! Current length ".concat(this.length));else{if(0===e)this.prepend(t);else if(e===this.length)this.append(t);else{for(var n=new T(t),i=this.head,a=0;a<e-1;a++)i=i.next;var o=i.next;n.next=o,i.next=n,n.previous=i,o.previous=n}this.length++}}},{key:"activateNodes",value:function(t){var e,n=0;e=t.constructor===Array?t:[t];for(var i=this.head;i;){var a,o=m(e);try{for(o.s();!(a=o.n()).done;){var r=a.value;i.value==r&&(i.active=!0,n+=1)}}catch(t){o.e(t)}finally{o.f()}if(n===e.length)return;i=i.next}}},{key:"deactivateNodes",value:function(t){var e,n=0;e=t.constructor===Array?t:[t];for(var i=this.head;i;){var a,o=m(e);try{for(o.s();!(a=o.n()).done;){var r=a.value;i.value==r&&(i.active=!1,n+=1)}}catch(t){o.e(t)}finally{o.f()}if(n===e.length)return;i=i.next}}},{key:"removeByValues",value:function(t){var e,n=0;e=t.constructor===Array?t:[t];for(var i=this.head;i;){var a,o=m(e);try{for(o.s();!(a=o.n()).done;){var r=a.value;i.value==r&&(i.previous&&i.next?(i.previous.next=i.next,i.next.previous=i.previous):i.previous?(this.tail=i.previous,this.tail.next=null):i.next?(this.head=i.next,this.head.previous=null):(this.head=null,this.tail=this.head),this.length--,n+=1)}}catch(t){o.e(t)}finally{o.f()}if(n===e.length)return;i=i.next}console.warn('"'.concat(array.join(", "),'" not found in list!'))}}],n&&w(e.prototype,n),t}(),T=function t(e){x(this,t),this.value=e,this.previous=null,this.next=null,this.active=!0};function E(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var A=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e||0,this.y=n||0,this.z=i||0}var e,n,i;return e=t,i=[{key:"add",value:function(e,n){return new t(e.x+n.x,e.y+n.y,e.z+n.z)}},{key:"sub",value:function(e,n){return new t(e.x-n.x,e.y-n.y,e.z-n.z)}},{key:"mult",value:function(e,n){return new t(e.x*n,e.y*n,e.z*n)}},{key:"div",value:function(e,n){var i,a,o;return 0!==n?(i=e.x/n,a=e.y/n,o=e.z/n):(console.warn("Dividing by zero!"),i=e.x,a=e.y,o=e.z_),new t(i,a,o)}},{key:"fromAngle2d",value:function(e){return new t(Math.cos(e),Math.sin(e))}},{key:"fromAngle3d",value:function(t,e){var n=Math.cos(e),i=Math.sin(e),a=Math.cos(t),o=Math.sin(t);return new p5.Vector(o*i,-1*a,o*n)}}],(n=[{key:"add",value:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}},{key:"sub",value:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}},{key:"mult",value:function(t){this.x*=t,this.y*=t,this.z*=t}},{key:"div",value:function(t){0!==t?(this.x/=t,this.y/=t,this.z/=t):console.warn("Dividing by zero!")}},{key:"angleBetween",value:function(e){return t.sub(e,this).heading()}},{key:"copy",value:function(){return new t(this.x,this.y,this.z)}},{key:"cross",value:function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}},{key:"dist",value:function(e){return t.sub(e,this).magnitude()}},{key:"distSq",value:function(e){return t.sub(e,this).magSq()}},{key:"dot",value:function(t){return this.x*(t.x||0)+this.y*(t.y||0)+this.z*(t.z||0)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}},{key:"heading",value:function(){return Math.atan2(this.y,this.x)}},{key:"lerp",value:function(e,n,i,a){e instanceof t?this.lerp(e.x,e.y,e.z,n):(this.x+=(e-this.x)*a||0,this.y+=(n-this.y)*a||0,this.z+=(i-this.z)*a||0)}},{key:"limit",value:function(t){var e=this.magnitude;e*e>t*t&&(this.div(e),this.mult(t))}},{key:"normalise",value:function(){var t=this.magnitude();0!==t&&this.mult(1/t)}},{key:"magnitude",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"magSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}}])&&E(e.prototype,n),i&&E(e,i),t}();function O(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function S(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var I=function(){function e(a,o,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=n.g.unitTotals;s[r]=s[r]+1,this.location=new A(a,o),this.velocity=new A(l.random(-1,1),l.random(-1,1)),this.acceleration=new A,this.size=new A(4,8),this.angle=this.velocity.heading(),this.angleOffset=0;var u=20+2*l.gaussian(),c=1+.25*l.gaussian(),h=20*this.size.x+l.gaussian()*this.size.x*2,f=.75*h,v=l.random(2,4);this.stats={team:r,platoon:null,health:100,attack:u,speed:c,FOV:130,acuity:h,range:f,restTime:v},this.state={behaviour:"NON-COMBAT",action:"REST",destination:null,target:null,previous:performance.now(),id:d(),colour:i.getRGB(t.teams[r])}}var a,o;return a=e,(o=[{key:"performBehaviour",value:function(t){if(!this.state.target&&t.length>=1){var e=this.getNearestEntity(t);if(e&&e.stats.team===this.stats.team)return void("NON-COMBAT"===e.state.behaviour&&"JOIN"!==e.state.action&&(this.state.action="JOIN",this.state.target=e,this.state.destination=e.location,e.state.action="JOIN",e.state.target=this,e.state.destination=this.location))}"NON-COMBAT"===this.state.behaviour?this.nonCombatBehaviour():"COMBAT"===this.state.behaviour&&this.combatBehaviour()}},{key:"nonCombatBehaviour",value:function(){"PATROL"===this.state.action?this.patrol():"REST"===this.state.action?this.rest():"JOIN"===this.state.action&&this.join()}},{key:"combatBehaviour",value:function(){"ATTACK"===this.state.action||this.state.action}},{key:"patrol",value:function(){this.location.equals(this.state.destination)?(this.state.destination=null,this.state.action="REST",this.state.previous=performance.now()):this.location.dist(this.state.destination)<this.stats.speed?this.location=this.state.destination.copy():(this.seek(this.state.destination),this.updateLocation())}},{key:"rest",value:function(){performance.now()-this.state.previous>1e3*this.stats.restTime&&(this.state.action="PATROL",this.getDestination(),this.seek(this.state.destination),this.angleOffset=0)}},{key:"join",value:function(){if(this.location.dist(this.state.target.location)<this.size.y*(this.size.x/2)){d();var t=this.state.target;this.state.target=null,this.state.destination=null,this.state.behaviour="PLATOON",this.state.action="PLATOON",this.stats.platoon=[this,t],t.state.target=null,t.state.destination=null,t.state.behaviour="PLATOON",t.state.action="PLATOON",t.stats.platoon=[this,t]}else this.seek(this.state.target.location),this.updateLocation()}},{key:"seek",value:function(t){n.g.context;var e=A.sub(t,this.location);e.normalise(),e.mult(this.stats.acuity/2);var i=l.random(0,2*Math.PI),a=this.size.y,o=A.add(e,new A(Math.cos(i)*a,Math.sin(i)*a));o.normalise(),o.mult(this.stats.speed),o.sub(this.velocity),this.angle=e.heading()+l.map(Math.cos(this.angleOffset),0-Math.PI,Math.PI,.25*Math.PI,.75*Math.PI),this.angleOffset+=.25*this.stats.speed,this.applyBehaviour(o)}},{key:"avoid",value:function(t){var e,n=new A,i=1*this.size.y,a=0,o=O(t);try{for(o.s();!(e=o.n()).done;){var r=e.value,s=this.location.dist(r.location);if(s>0&&s<i){var l=A.sub(r.location,this.location);l.normalise(),l.div(s),l.mult(-1),n.add(l),a++}}}catch(t){o.e(t)}finally{o.f()}if(a>=1&&(n.div(a),n.normalise(),n.mult(this.stats.speed),n.sub(this.velocity)),"PLATOON"===this.state.behaviour)return n;this.applyBehaviour(n)}},{key:"cohere",value:function(t){var e,n=new A(0,0),i=4*this.size.y,a=0,o=O(t);try{for(o.s();!(e=o.n()).done;){var r=e.value,s=this.location.dist(r.location);if(s>0&&s>i){var l=A.sub(r.location,this.location);l.normalise(),l.div(s),n.add(l),a++}}}catch(t){o.e(t)}finally{o.f()}if(a>=1&&(n.div(a),n.normalise(),n.mult(this.stats.speed),n.sub(this.velocity)),"PLATOON"===this.state.behaviour)return n;this.applyBehaviour(n)}},{key:"align",value:function(t){var e,n=new A,i=O(t);try{for(i.s();!(e=i.n()).done;){var a=e.value;this.state.id!==a.state.id&&n.add(a.velocity)}}catch(t){i.e(t)}finally{i.f()}if(n.div(t.length),n.normalise(),n.mult(this.stats.speed),n.sub(this.velocity),"PLATOON"===this.state.behaviour)return n;this.applyBehaviour(n)}},{key:"getDestination",value:function(){var t=n.g,e=t.WIDTH,i=t.HEIGHT,a=new A(Math.random()*e,Math.random()*i),o=A.sub(a,this.location),r=o.magnitude();o.normalise(),r>2*this.stats.acuity&&(o.mult(2*this.stats.acuity),a.x=this.location.x+o.x,a.y=this.location.y+o.y),this.state.destination=a}},{key:"updateLocation",value:function(){this.velocity.add(this.acceleration),this.velocity.limit(this.stats.speed),this.location.add(this.velocity),this.acceleration.mult(0)}},{key:"getNearestEntity",value:function(t){var e,n,i=1e6,a=O(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,r=this.location.dist(o.location);r<i&&(i=r,e=o)}}catch(t){a.e(t)}finally{a.f()}return e||!1}},{key:"applyBehaviour",value:function(t){this.acceleration.add(t)}},{key:"checkEdges",value:function(){var t=n.g,e=t.WIDTH,i=t.HEIGHT;this.location.x<0?this.location.x=0:this.location.x>e-this.size.x&&(this.location.x=e-this.size.x),this.location.y<0?this.location.y=0:this.location.y>i-this.size.y&&(this.location.y=i-this.size.y)}},{key:"render",value:function(){var t=n.g.context;t.save(),t.translate(this.location.x,this.location.y),t.rotate(this.angle),t.fillStyle=this.state.colour,t.fillRect(-.25*this.size.x,-.5*this.size.y,.5*this.size.x,.25*this.size.y),t.fillRect(-.25*this.size.x,.25*this.size.y,.5*this.size.x,.25*this.size.y),t.fillRect(-.5*this.size.x,-.25*this.size.y,this.size.x,.5*this.size.y),t.restore()}}])&&S(a.prototype,o),e}();function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function M(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var R=function(){function e(t,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a[0].stats.team;M(this,e);var r=n.g,s=r.platoonTotals;s[o]=s[o]+1,this.location=new A(t,i),this.velocity=new A(l.random(-1,1),l.random(-1,1)),this.acceleration=new A,this.stats={team:o,FOV:130},this.state={behaviour:"NON-COMBAT",action:"REST",destination:0,target:0,direction:0,previous:performance.now(),id:d()},this.units=a?this.populate(a):this.populate(o)}var a,o;return a=e,o=[{key:"populate",value:function(t){var e=new k,n=0,i=0,a=0;if(t.constructor===Array){var o,r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}(t);try{for(r.s();!(o=r.n()).done;){var s=o.value;e.append(s),n=s.stats.speed>n?s.stats.speed:n,i=s.stats.acuity>i?s.stats.acuity:i,a=s.stats.restTime>a?s.stats.restTime:a}}catch(t){r.e(t)}finally{r.f()}}else for(var l=0;l<9;l++){var u=new I(this.location.x+20*Math.random(),this.location.y+20*Math.random(),t);u.state.behaviour="PLATOON",u.state.action="PLATOON",e.append(u),n=u.stats.speed>n?u.stats.speed:n,i=u.stats.acuity>i?u.stats.acuity:i,a=u.stats.restTime>a?u.stats.restTime:a}return this.stats.speed=n,this.stats.acuity=i,this.stats.restTime=a,this.state.formation=g.getFormation(e.length),e}},{key:"update",value:function(){"NON-COMBAT"===this.state.behaviour&&("PATROL"===this.state.action?this.patrol():"REST"===this.state.action&&this.rest())}},{key:"patrol",value:function(){var t=this;this.location.equals(this.state.destination)?this.units.getAll().every((function(e){return e.location.dist(t.location)<e.size.y*(e.size.x/2)}))?(this.state.destination=null,this.state.action="REST",this.state.previous=performance.now()):this.moveUnits():this.location.dist(this.state.destination)<this.stats.speed?(this.location=this.state.destination.copy(),this.moveUnits()):(this.seek(this.state.destination),this.updateLocation(),this.moveUnits())}},{key:"rest",value:function(){performance.now()-this.state.previous>1e3*this.stats.restTime&&(this.state.action="PATROL",this.getDestination())}},{key:"moveUnits",value:function(){var t=this,e=this.units.getAll();e.forEach((function(n){n.location.dist(t.location)>2*n.size.y&&n.seek(t.location),t.flock(n,e),n.updateLocation(),n.checkEdges()}))}},{key:"flock",value:function(t,e){var n=t.avoid(e),i=t.cohere(e);n.mult(.2),i.mult(.2),t.applyBehaviour(n),t.applyBehaviour(i)}},{key:"seek",value:function(t){var e=A.sub(t,this.location);e.normalise(),e.mult(this.stats.speed),e.sub(this.velocity),this.applyBehaviour(e),this.angle=e.heading()}},{key:"getDestination",value:function(){var t=n.g,e=t.WIDTH,i=t.HEIGHT,a=new A(Math.random()*e,Math.random()*i),o=A.sub(a,this.location),r=o.magnitude();o.normalise(),r>2*this.stats.acuity&&(o.mult(2*this.stats.acuity),a.x=this.location.x+o.x,a.y=this.location.y+o.y),this.state.destination=a}},{key:"updateLocation",value:function(){this.velocity.add(this.acceleration),this.velocity.limit(this.stats.speed),this.location.add(this.velocity),this.acceleration.mult(0)}},{key:"applyBehaviour",value:function(t){this.acceleration.add(t)}},{key:"checkEdges",value:function(){var t=n.g.canvas;this.location.x<0?this.location.x=t.width:this.location.x>t.width&&(this.location.x=0),this.location.y<0?this.location.y=t.height:this.location.y>t.height&&(this.location.y=0)}},{key:"render",value:function(){var e=n.g.context;e.beginPath(),e.save(),e.translate(this.location.x,this.location.y),e.rotate(this.velocity.heading()),e.fillStyle=i.getRGBA(t.GREY,.3),e.arc(0,0,10,0,2*Math.PI),e.fill(),e.restore(),e.closePath()}}],o&&P(a.prototype,o),e}();function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function B(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var N=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.width=n.g.WIDTH,this.height=n.g.HEIGHT,this.cellsX=e,this.cellsY=i,this.cellSize=new A(n.g.WIDTH/e,n.g.HEIGHT/i),this.cells=this.initaliseCells()}var e,i;return e=t,(i=[{key:"initaliseCells",value:function(){for(var t=[],e=0;e<this.cellsY;e++){for(var n=[],i=0;i<this.cellsX;i++)n.push({position:new A(i,e),obstacles:new k,platoons:new k,units:new k,ballistics:new k});t.push(n)}return t}},{key:"getCellFromVector",value:function(t){var e=Math.floor(t.x/this.cellSize.x),n=Math.floor(t.y/this.cellSize.y);return this.cells[n][e]}},{key:"updateCell",value:function(t,e){var n=this.getCellFromVector(t.location);e.position.equals(n.position)||(t instanceof I?(n.units.append(t),e.units.removeByValues(t)):t instanceof R&&(n.platoons.append(t),e.platoons.removeByValues(t)))}},{key:"getVisibleEntities",value:function(t){var e=this.getCellFromVector(t.location),n=this.getNeighbouringCells(e),i=[],a=t.velocity.copy();a.normalise();var o,r=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return L(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}(n);try{for(r.s();!(o=r.n()).done;)for(var s=o.value.units.head;s;){var u=s.value;if(t.state.id===u.state.id)s=s.next;else{if((u.location.x-t.location.x)*(u.location.x-t.location.x)+(u.location.y-t.location.y)*(u.location.y-t.location.y)<t.stats.acuity*t.stats.acuity){var c=new A(u.location.x-t.location.x,u.location.y-t.location.y);c.normalise();var h=a.dot(c);l.map(h,-1,1,180,0)<t.stats.FOV/2&&i.push(u)}s=s.next}}}catch(t){r.e(t)}finally{r.f()}return i}},{key:"getNeighbouringCells",value:function(t){var e=[t.position.x],n=[t.position.y];0===t.position.x?e.push(t.position.x+1):t.position.x===this.cellsX-1?e.push(t.position.x-1):(e.push(t.position.x-1),e.push(t.position.x+1)),0===t.position.y?n.push(t.position.y+1):t.position.y===this.cellsY-1?n.push(t.position.y-1):(n.push(t.position.y-1),n.push(t.position.y+1));for(var i=[],a=0;a<n.length;a++)for(var o=0;o<e.length;o++)i.push(this.cells[n[a]][e[o]]);return i}},{key:"createPlatoon",value:function(t){var e=t[0].location,n=new R(e.x,e.y,t),i=this.getCellFromVector(t[0].location);i.platoons.append(n),i.units.deactivateNodes(t)}},{key:"addUnitToPlatoon",value:function(t,e){e.units.append(t),this.getCellFromVector(t.location).units.deactivateNodes(t)}}])&&B(e.prototype,i),t}();function H(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var j=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i;return e=t,i=[{key:"initialiseCanvas",value:function(t){var e=window.innerWidth-2*t,i=window.innerHeight-2*t,a=document.createElement("div");a.id="container",a.style.padding="".concat(t,"px");var o=document.createElement("canvas");o.width=e,o.height=i,a.appendChild(o),document.body.appendChild(a),this.canvas=document.querySelector("canvas"),this.context=o.getContext("2d"),n.g={canvas:this.canvas,context:this.context,WIDTH:e,HEIGHT:i,unitTotals:{RED:0,BLUE:0,GREEN:0,YELLOW:0},platoonTotals:{RED:0,BLUE:0,GREEN:0,YELLOW:0}}}},{key:"initialiseMap",value:function(){return new o}},{key:"initialiseGrid",value:function(){var t=new N(6,4);return this.initialisePlatoons(t),t}},{key:"initialiseUnits",value:function(t){n.g.unitTotals;for(var e,i=0;i<24;i++){var a=new A(Math.random()*n.g.WIDTH,Math.random()*n.g.HEIGHT);i%4==0?e="RED":i%4==1?e="BLUE":i%4==2?e="GREEN":i%4==3&&(e="YELLOW");var o=new I(a.x,a.y,e);t.getCellFromVector(a).units.append(o)}}},{key:"initialisePlatoons",value:function(t){for(var e=0;e<5;e++){var i=new A(l.random(50,n.g.WIDTH-50),l.random(50,n.g.HEIGHT-50));t.getCellFromVector(i).platoons.append(new R(i.x,i.y,!1,"RED"))}}}],null&&H(e.prototype,null),i&&H(e,i),t}();function G(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,o=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw o}}}}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function U(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var V=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),j.initialiseCanvas(20),this.grid=j.initialiseGrid(),this.map=j.initialiseMap(),this.running=!0,this.previous=performance.now()}var a,o;return a=e,(o=[{key:"run",value:function(){var e=n.g,a=e.context,o=e.WIDTH,r=e.HEIGHT;this.draw(),this.running?this.update():(performance.now()-this.previous)%1600<800&&(a.font="32px PressStart2P",a.textBaseline="top",a.textAlign="center",a.fillStyle=i.getRGB(t.WHITE),a.fillText("PAUSED",o/2,r/2)),requestAnimationFrame(this.run.bind(this))}},{key:"update",value:function(){for(var t=0;t<this.grid.cellsY;t++)for(var e=0;e<this.grid.cellsX;e++){for(var n=this.grid.cells[t][e],i=n.platoons.head,a=n.units.head;i&&i.active;){var o=i.value;i=i.next,o.update(),o.checkEdges(),this.grid.updateCell(o,n)}for(;a&&a.active;){var r=a.value;if(a=a.next,"PLATOON"===r.state.behaviour)r.stats.platoon.constructor===Array?this.grid.createPlatoon(r.stats.platoon):r.stats.platoon instanceof Platoon&&this.grid.addUnitToPlatoon(r,r.stats.platoon);else{var s=this.grid.getVisibleEntities(r);r.performBehaviour(s),r.checkEdges(),this.grid.updateCell(r,n)}}}}},{key:"draw",value:function(){var e=n.g,a=e.context,o=e.platoonTotals,r=e.unitTotals;a.clearRect(0,0,n.g.WIDTH,n.g.HEIGHT),this.map.render(this.grid);for(var s=0;s<this.grid.cellsY;s++)for(var l=0;l<this.grid.cellsX;l++){for(var u=this.grid.cells[s][l],c=u.platoons.head,h=u.units.head;c&&c.active;){var f,v=G(c.value.units.getAll());try{for(v.s();!(f=v.n()).done;)f.value.render()}catch(t){v.e(t)}finally{v.f()}c=c.next}for(;h&&h.active;)h.value.render(),h=h.next}a.font="16px PressStart2P",a.textBaseline="top",a.textAlign="center",a.fillStyle=i.getRGBA(t.teams.RED,.5),a.fillText(r.RED,20,20),a.fillText(o.RED,20,50),a.fillStyle=i.getRGBA(t.teams.BLUE,.5),a.fillText(r.BLUE,80,20),a.fillText(o.BLUE,80,50),a.fillStyle=i.getRGBA(t.teams.GREEN,.5),a.fillText(r.GREEN,140,20),a.fillText(o.GREEN,140,50),a.fillStyle=i.getRGBA(t.teams.YELLOW,.5),a.fillText(r.YELLOW,200,20),a.fillText(o.YELLOW,200,50)}}])&&U(a.prototype,o),e}(),W=n(379),F=n.n(W),Y=n(795),q=n.n(Y),$=n(569),X=n.n($),J=n(565),Z=n.n(J),_=n(216),K=n.n(_),Q=n(589),tt=n.n(Q),et=n(426),nt={};nt.styleTagTransform=tt(),nt.setAttributes=Z(),nt.insert=X().bind(null,"head"),nt.domAPI=q(),nt.insertStyleElement=K(),F()(et.Z,nt),et.Z&&et.Z.locals&&et.Z.locals;var it=new V;document.addEventListener("keyup",(function(t){"p"===t.key&&(it.running=!it.running,it.pauseVisible=!0,it.previous=performance.now())})),it.run()})()})();